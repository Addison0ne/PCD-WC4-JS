const _blockPositions=[0,1,2,3,0,1,3,2,0,2,1,3,0,3,1,2,0,2,3,1,0,3,2,1,1,0,2,3,1,0,3,2,2,0,1,3,3,0,1,2,2,0,3,1,3,0,2,1,1,2,0,3,1,3,0,2,2,1,0,3,3,1,0,2,2,3,0,1,3,2,0,1,1,2,3,0,1,3,2,0,2,1,3,0,3,1,2,0,2,3,1,0,3,2,1,0],_blockPositionInvert=[0,1,2,4,3,5,6,7,12,18,13,19,8,10,14,20,16,22,9,11,15,21,17,23];class LCRng{constructor(e,n,t){this.nSeed=new Uint32Array(3),this.nSeed[0]=e,this.nSeed[1]=1103515245,this.nSeed[2]=24691}Next(){return this.nSeed[0]=Math.imul(this.nSeed[1],this.nSeed[0]),this.nSeed[0]=this.nSeed[0]+this.nSeed[2],this.nSeed[0]>>>16}}function SwapEndian(e){return e.reverse()}function Shuffle(e,n){for(var t=[],r=0;r<4;r++)for(let i=0;i<32;i++){let o=i+32*_blockPositions[r+4*n];t=t.concat(e[o+16])}for(r=0;r<128;r++)e[r+16]=t[r];return e}function XORCrypt(e,n){var t=new Uint8Array(856);let r=SwapEndian(e.slice(14,16)),i=256*r[0]+r[1],o=new LCRng(i);for(let n=0;n<856;n++)(n<16||n>244)&&(t[n]=e[n]);for(var l=16;l<244;l+=2){144==l&&(o=new LCRng(n));var s=SwapEndian(e.slice(l,l+2));let r=256;var c=0;for(let e=0;e<2;e++)c+=s[e]*r,r/=256;c>>>=0,v0=c^o.Next()>>>0,v1=Number("0x"+v0.toString(16).padStart(4,"0").slice(2)),v2=Number("0x"+v0.toString(16).padStart(4,"0").slice(0,2)),t[l]=v1,t[l+1]=v2}return t}function EncryptWC4(e){if(856==e.length){console.log("Encrypting WC4");let n=SwapEndian(e.slice(8,12)),t=0,r=16777216;for(let e=0;e<4;e++)t+=n[e]*r,r/=256;return XORCrypt(Shuffle(e,_blockPositionInvert[((253952&t)>>13)%24]),t)}console.log("Wrong file size")}function DecryptPCD(e){if(856==e.length){console.log("Decrypting PCD");let n=SwapEndian(e.slice(8,12)),t=0,r=16777216;for(let e=0;e<4;e++)t+=n[e]*r,r/=256;let i=((253952&t)>>13)%24;return Shuffle(XORCrypt(e,t),i)}console.log("Wrong file size!")}